{{define "body"}}
<div class="content-wrapper">
  <!-- Game Details -->
  <div class="card mb-6">
    <div class="card-content">
      <div class="is-flex is-justify-content-space-between is-align-items-start">
        <div>
          <h1 class="title is-2">{{.Data.Game.Name}}</h1>
          <p class="subtitle is-5 mb-5">{{.Data.Game.Description}}</p>
          
          <div class="is-flex is-align-items-center mb-3">
            <span class="icon has-text-info mr-2">
              <i class="fas fa-users"></i>
            </span>
            <span>{{.Data.Game.MinPlayers}}-{{.Data.Game.MaxPlayers}} players</span>
          </div>
{{if .Data.Game.Tags}}
<div class="tags mt-4">
  {{range .Data.Game.Tags}}
  <span class="tag is-info is-light">{{.}}</span>
  {{end}}
</div>
          {{end}}
        </div>
<div class="box p-4 has-background-white-ter">
  <p class="has-text-grey mb-2">Your Rating:</p>
  <div class="buttons has-addons">
    {{range $i := slice 1 2 3 4 5}}
    <button onclick="rateGame('{{$.Data.Game.ID}}', {{$i}})"
      class="button is-small rating-star {{if le $i $.Data.Rating}}is-warning{{else}}is-light{{end}}">
      <span class="icon is-small">
        <i class="fas fa-star"></i>
      </span>
    </button>
    {{end}}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Upcoming Events -->
  <div class="card">
    <header class="card-header">
      <p class="card-header-title">
        <span class="icon mr-2"><i class="fas fa-calendar-alt"></i></span>
        Upcoming Events with this Game
      </p>
    </header>
    <div class="card-content">
      {{if .Data.Game.Events}}
      <div class="columns is-multiline">
        {{range .Data.Game.Events}}
          <div class="column is-6">
            <div class="box has-background-white-ter">
              <h3 class="title is-5">{{.Title}}</h3>
              <p class="subtitle is-6 has-text-grey mb-3">{{.Description}}</p>
              <div class="is-flex is-align-items-center mb-3">
                <span class="icon has-text-info mr-2">
                  <i class="fas fa-map-marker-alt"></i>
                </span>
                <span>{{.Location}}</span>
              </div>
              <div class="is-flex is-align-items-center mb-3">
                <span class="icon has-text-info mr-2">
                  <i class="fas fa-calendar"></i>
                </span>
                <span>{{.StartTime.Format "Jan 2, 2006"}}</span>
              </div>
              <div class="is-flex is-align-items-center mb-3">
                <span class="icon has-text-info mr-2">
                  <i class="fas fa-clock"></i>
                </span>
                <span>{{.StartTime.Format "3:04 PM"}} - {{.EndTime.Format "3:04 PM"}}</span>
                </div>
                <a href="/events/{{.ID}}" class="button is-link is-outlined is-fullwidth">
                  View Event
                  <span class="icon ml-1">
                    <i class="fas fa-arrow-right"></i>
                  </span>
              </a>
            </div>
          </div>
          {{end}}
        </div>
      {{else}}
      <div class="notification is-light has-text-centered">
        <p>There are no upcoming events featuring this game.</p>
        <a href="/events/new" class="button is-primary is-small mt-3">
          <span class="icon">
            <i class="fas fa-calendar-plus"></i>
          </span>
          <span>Create Event</span>
        </a>
        </div>
      {{end}}
    </div>
  </div>
</div>

<script>
  function rateGame(gameId, rating) {
    fetch(`/games/${gameId}/rate`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ rating: rating })
    })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          const stars = document.querySelectorAll('.rating-star');
          stars.forEach((star, index) => {
            star.classList.toggle('is-warning', index < rating);
            star.classList.toggle('is-light', index >= rating);
          });
        }
      })
      .catch(error => console.error('Error:', error));
  }
</script>
{{end}}
